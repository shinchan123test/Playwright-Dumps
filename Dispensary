import { test, Locator, Page } from '@playwright/test'

export default class DispensaryPage {

  readonly page: Page;
  private maxRetries = 3;
  private timeoutDuration = 5000;
  public dispensary: {
    dispensaryLink: Locator;
    activateCounter: Locator;
    counterSelection: Locator;
    counterName: Locator;
    activatedCounterInfo: Locator;
    deactivateCounterButton: Locator;
    titleName: Locator;
    name: Locator;
    prescription: Locator;
    reports: Locator;
    fromDate: Locator;
    showReportButton: Locator;
    userCollectionReport: Locator;
    counterDropdown: Locator;
    counterNameFromTable: Locator;
    rightPointerIcon: string;
    tooltipText: Locator;
  };

  constructor(page: Page) {
    this.page = page;
    this.dispensary = {
      dispensaryLink: page.getByRole('link', { name: 'Dispensary ' }),
      activateCounter: page.locator(""),
      counterSelection: page.locator(''),
      counterName: page.locator(''),
      activatedCounterInfo: page.locator(``),
      deactivateCounterButton: page.locator(``),
      titleName: page.locator(''),
      name: page.locator(''),
      prescription: page.locator(""),
      reports: page.getByRole('link', { name: 'Reports', exact: true }),
      fromDate: page.locator('#date'),
      showReportButton: page.getByRole('button', { name: 'Show Report' }),
      userCollectionReport: page.getByRole('link', { name: ' User Collection Report' }),
      counterDropdown: page.locator(`#ddlCounter`),
      counterNameFromTable: page.locator(``),
      rightPointerIcon: '',
      tooltipText: page.locator(''),
    };
  }

  /**
  * @Test1 Verify tooltip text when hovering over the dispensary pointer icon.
  *
  * @returns {Promise<string>} - Returns the trimmed tooltip text; throws an error if the tooltip text does not match the expected value.
  *
  * Steps:
  * 1. Click on the Dispensary link to open the dispensary section.
  * 2. Hover over the right-pointing icon to trigger the tooltip.
  * 3. Capture the tooltip text displayed.
  * 4. Verify that the tooltip text matches the expected message:
  *    "You are currently in Main Dispensary dispensary. To change, you can always click here."
  * 5. Return the actual tooltip text.
  */

  async verifyAndReturnDispensaryTooltipText(): Promise<string> {
    const counter = await this.page.locator("//a[text()='X']");
    if (counter) {
      await counter.click();
    }
    await this.dispensary.dispensaryLink.click();
    await this.dispensary.dispensaryLink.click();
    await this.page.locator('a').filter({ hasText: 'Main Dispensarydispensary' }).click();
    await this.page.locator("//label[text()=' Active Dispensary : ']/../i").hover();
    const text = await this.page.getByText('You are currently in Main Dispensary dispensary. To change, you can always click here.').innerText();

    return text;
  }
}


